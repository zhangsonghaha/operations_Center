# WebSocket 连接修复方案

经过排查，WebSocket 连接失败（Error 1006）的根本原因在于 **Spring Security 拦截了 WebSocket 握手请求**。

目前的 `SecurityConfig.java` 配置要求除登录、静态资源外的所有请求都必须经过身份验证（`.anyRequest().authenticated()`）。由于 WebSocket 握手请求（`/ws/ssh`）在前端通过 `new WebSocket()` 发起时，默认不携带 HTTP Header 中的 Token，因此会被 Spring Security 拒绝，导致连接中断。

## 修复步骤

### 1. 后端配置修改
在 `SecurityConfig.java` 中明确放行 WebSocket 路径 `/ws/**`，允许匿名访问（握手阶段）。
*   **注意**：虽然放行了握手，但为了安全，我们应当在 `WebSshWebSocketHandler` 中通过 URL 参数（如 `?token=xxx`）来校验用户身份。但为快速打通流程，目前先配置为允许匿名连接，后续可按需增强安全性。

### 2. 前端连接逻辑优化（已在之前的步骤中完成优化，确认无误）
前端 `terminal.vue` 已经配置为优先连接 `ws://localhost:8080/ws/ssh`（开发环境），这符合预期。

## 执行计划
1.  **修改 `SecurityConfig.java`**：在 `.authorizeHttpRequests` 链中添加 `.antMatchers("/ws/**").permitAll()`。
2.  **重启后端服务**：这是必须步骤，否则安全配置不会生效。

我将立即执行配置修改。
