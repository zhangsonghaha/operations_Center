# 服务器状态检测与密钥管理增强方案

为满足您的需求，我将对现有的服务器管理功能进行以下增强：

## 1. 真实心跳检测 (Real Heartbeat Check)
不再使用静态的“状态”字段，而是实现真正的主机连通性检测。
*   **检测机制**：后端通过 Java 的 `InetAddress.isReachable` (ICMP/Ping) 或尝试建立 TCP 连接（针对 SSH 端口）来判断主机是否在线。
*   **定时任务**：集成 `Quartz` 定时任务，每分钟（可配置）自动检测所有服务器状态。
*   **手动刷新**：在前端列表增加“检测连接”按钮，支持单台服务器的即时连通性测试。

## 2. 密钥管理增强 (Key Management)
*   **密钥导入功能**：前端支持上传 SSH 私钥文件（.pem, .ppk 等），后端解析文件内容并存储到数据库。
*   **安全存储**：对密钥内容进行加密存储（虽然在演示环境中可暂存明文，但生产环境建议加密）。

## 3. 配置化支持 (Configurable)
*   **检测超时时间**：在配置文件或字典中设置连接超时时间（如 3000ms）。
*   **检测端口**：优先检测 SSH 端口，如果 SSH 端口不通则视为离线。

## 实施步骤
1.  **后端改造**：
    *   在 `OpsServerController` 中增加 `/check/{serverId}` 接口，用于手动触发检测。
    *   在 `IOpsServerService` 中实现 `checkConnection` 方法，使用 `Socket` 尝试连接服务器 SSH 端口。
2.  **前端改造**：
    *   在服务器列表增加“状态检测”列，显示实时 Ping 值或连接状态。
    *   在新增/编辑弹窗中，增加“导入密钥”上传组件，读取文件内容填充到密钥输入框。
3.  **定时任务（可选）**：
    *   如果需要后台自动刷新，可以添加一个 Quartz 任务调用检测逻辑（暂按手动触发实现，以减少系统复杂度）。

现在我将开始实施这些变更。
