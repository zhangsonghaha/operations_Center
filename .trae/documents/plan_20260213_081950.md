# 服务器 SSH 连接验证与网络诊断增强方案

为了实现更深入的服务器连接检测，我将引入 JSch 库来实现真实的 SSH 登录验证（支持密码和密钥），并结合网络连通性测试来判断是内网还是外网可达。

## 1. 核心功能增强
*   **SSH 登录验证**：不仅检测端口连通性，还尝试使用存储的账号/密码或密钥进行 SSH 登录握手。如果登录成功，则证明凭证有效。
*   **网络环境智能判断**：
    *   优先尝试连接 **内网 IP**。
    *   如果内网不通，再尝试连接 **公网 IP**。
    *   返回结果中明确指出是通过哪个 IP 连接成功的，从而判断当前网络环境（"内网可达" 或 "仅公网可达"）。

## 2. 技术选型
*   **SSH 库**：使用 **JSch** (Java Secure Channel) 库，它是 Java 生态中最成熟的 SSH 实现，支持密码和密钥认证。

## 3. 实施步骤

### 3.1 依赖引入
在 `ruoyi-admin/pom.xml` 中引入 JSch 依赖。

### 3.2 后端逻辑升级 (`OpsServerServiceImpl`)
重构 `checkConnection` 方法：
1.  **第一阶段：内网探测**
    *   尝试 TCP 连接内网 IP:端口。
    *   如果通，尝试使用 JSch 进行 SSH 登录。
    *   记录结果：`内网连接成功 (SSH验证通过)` 或 `内网端口通 (SSH验证失败)`。
2.  **第二阶段：公网探测** (如果内网不通)
    *   尝试 TCP 连接公网 IP:端口。
    *   如果通，尝试 SSH 登录。
    *   记录结果：`公网连接成功` 等。
3.  **结果聚合**：返回包含网络类型（Intranet/Internet）和验证结果（Success/Auth Failed/Unreachable）的详细消息。

### 3.3 前端展示优化 (`index.vue`)
*   修改检测结果提示，区分显示：
    *   🟢 **内网可达** (SSH OK)
    *   🔵 **公网可达** (SSH OK)
    *   🟡 **端口通/认证失败**
    *   🔴 **无法连接**

## 4. 安全性考量
*   SSH 连接测试建立后会立即断开，不执行任何命令，仅验证握手和认证过程。
*   异常处理涵盖连接超时、认证失败、HostKey 变更等常见 SSH 错误。
